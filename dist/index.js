!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("react")):"function"==typeof define&&define.amd?define(["react"],t):"object"==typeof exports?exports.webrtcVideoChat=t(require("react")):e.webrtcVideoChat=t(e.react)}(self,(e=>(()=>{"use strict";var t={155:t=>{t.exports=e}},r={};function n(e){var a=r[e];if(void 0!==a)return a.exports;var c=r[e]={exports:{}};return t[e](c,c.exports,n),c.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var a={};n.r(a),n.d(a,{ScreenShare:()=>l,VideoChat:()=>u});var c=n(155),o=n.n(c);const s=(e,t)=>{const r=(0,c.useRef)(null),n=(0,c.useRef)(null),a=(0,c.useRef)(null),[o,s]=(0,c.useState)(!1);return(0,c.useEffect)((()=>{const t=new WebSocket(e);return t.onmessage=e=>{const c=JSON.parse(e.data);switch(c.type){case"offer":(async e=>{a.current||(a.current=new RTCPeerConnection,a.current.onicecandidate=e=>{e.candidate&&t.send(JSON.stringify({type:"candidate",candidate:e.candidate}))},a.current.ontrack=e=>{n.current.srcObject=e.streams[0]},r.current.getTracks().forEach((e=>{a.current.addTrack(e,r.current)}))),await a.current.setRemoteDescription(new RTCSessionDescription(e));const c=await a.current.createAnswer();await a.current.setLocalDescription(c),t.send(JSON.stringify({type:"answer",answer:c}))})(c.offer);break;case"answer":(async e=>{await a.current.setRemoteDescription(new RTCSessionDescription(e))})(c.answer);break;case"candidate":o=c.candidate,a.current.addIceCandidate(new RTCIceCandidate(o))}var o},(async()=>{r.current=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0}),s(!0)})(),()=>{t.close(),a.current&&a.current.close()}}),[e,t]),{localStreamRef:r,remoteStreamRef:n,isConnected:o}},i=e=>{let{stream:t}=e;const r=(0,c.useRef)();return(0,c.useEffect)((()=>{r.current&&t&&(r.current.srcObject=t)}),[t]),o().createElement("video",{ref:r,autoPlay:!0,muted:!0})},d=e=>{let{stream:t}=e;const r=(0,c.useRef)();return(0,c.useEffect)((()=>{r.current&&t&&(r.current.srcObject=t)}),[t]),o().createElement("video",{ref:r,autoPlay:!0})},u=e=>{let{signalingUrl:t,roomId:r}=e;const{localStreamRef:n,remoteStreamRef:a,isConnected:c}=s(t,r);return c?o().createElement("div",null,o().createElement("h2",null,"Video Chat Room: ",r),o().createElement("div",null,o().createElement(i,{stream:n.current}),o().createElement(d,{stream:a.current}))):o().createElement("div",null,"Connecting...")},l=e=>{let{signalingUrl:t,roomId:r}=e;const n=(0,c.useRef)(null),a=(0,c.useRef)(null),s=(0,c.useRef)(null),i=(0,c.useRef)(null);return(0,c.useEffect)((()=>((async()=>{try{const e=await navigator.mediaDevices.getDisplayMedia({video:!0});n.current.srcObject=e;const c=new RTCPeerConnection;s.current=c,e.getTracks().forEach((t=>c.addTrack(t,e))),c.ontrack=e=>{a.current.srcObject=e.streams[0]},i.current=new WebSocket(t),i.current.onmessage=async e=>{try{const t=JSON.parse(e.data);if(t.offer){await c.setRemoteDescription(new RTCSessionDescription(t.offer));const e=await c.createAnswer();await c.setLocalDescription(e),i.current.send(JSON.stringify({answer:e}))}t.answer&&await c.setRemoteDescription(new RTCSessionDescription(t.answer)),t.candidate&&await c.addIceCandidate(new RTCIceCandidate(t.candidate))}catch(t){console.error("Error parsing message:",e.data,t)}},c.onicecandidate=e=>{e.candidate&&i.current.send(JSON.stringify({candidate:e.candidate}))};const o=await c.createOffer();await c.setLocalDescription(o),i.current.onopen=()=>{i.current.send(JSON.stringify({offer:o,roomId:r}))}}catch(e){console.error("Error sharing screen:",e)}})(),()=>{i.current&&i.current.close(),s.current&&s.current.close()})),[t,r]),o().createElement("div",null,o().createElement("video",{ref:n,autoPlay:!0,playsInline:!0,muted:!0,style:{width:"300px"}}),o().createElement("video",{ref:a,autoPlay:!0,playsInline:!0,style:{width:"300px"}}))};return a})()));